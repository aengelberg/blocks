<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>blocks.core documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Blocks</span> <span class="project-version">0.4.0</span></span></a></h1></div><div class="sidebar primary"><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>blocks</span></div></div></li><li class="depth-2 branch current"><a href="blocks.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="blocks.data.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></div></li><li class="depth-3 branch"><a href="blocks.store.file.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>file</span></div></a></li><li class="depth-3 branch"><a href="blocks.store.memory.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>memory</span></div></a></li><li class="depth-3"><a href="blocks.store.tests.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tests</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="blocks.core.html#var-BlockStore"><div class="inner"><span>BlockStore</span></div></a></li><li class="depth-2 branch"><a href="blocks.core.html#var--get"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>-get</span></div></a></li><li class="depth-2 branch"><a href="blocks.core.html#var--list"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>-list</span></div></a></li><li class="depth-2 branch"><a href="blocks.core.html#var-delete.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>delete!</span></div></a></li><li class="depth-2 branch"><a href="blocks.core.html#var-put.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>put!</span></div></a></li><li class="depth-2"><a href="blocks.core.html#var-stat"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stat</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-default-algorithm"><div class="inner"><span>default-algorithm</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-from-file"><div class="inner"><span>from-file</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-get"><div class="inner"><span>get</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-list"><div class="inner"><span>list</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-load.21"><div class="inner"><span>load!</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-meta-stats"><div class="inner"><span>meta-stats</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-open"><div class="inner"><span>open</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-read.21"><div class="inner"><span>read!</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-store.21"><div class="inner"><span>store!</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-validate.21"><div class="inner"><span>validate!</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-with-stats"><div class="inner"><span>with-stats</span></div></a></li><li class="depth-1"><a href="blocks.core.html#var-write.21"><div class="inner"><span>write!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">blocks.core</h1><div class="doc"><div class="markdown"><p>Block storage protocol and utilities. Functions which may cause IO to occur are marked with bangs.</p>
<p>For example <code>(read! &quot;foo&quot;)</code> doesn&rsquo;t have side-effects, but <code>(read!
some-input-stream)</code> will consume bytes from the stream.</p>
<p>When blocks are returned from a block store, they may include &lsquo;stat&rsquo; metadata about the blocks, including:</p>
<ul>
  <li><code>:stored-at</code> time block was added to the store</li>
  <li><code>:origin</code> resource location for the block</li>
</ul></div></div><div class="public anchor" id="var-BlockStore"><h3>BlockStore</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Protocol for content-addressable storage keyed by multihash identifiers.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var--get"><h3>-get</h3><div class="usage"><code>(-get store id)</code></div><div class="doc"><div class="markdown"><p>Returns the identified block if it is stored, otherwise nil. The block should include stat metadata. Typically clients should use <code>get</code> instead, which validates arguments and the returned block record.</p></div></div></div><div class="public anchor" id="var--list"><h3>-list</h3><div class="usage"><code>(-list store opts)</code></div><div class="doc"><div class="markdown"><p>Lists the blocks contained in the store. Returns a lazy sequence of stat metadata about each block. See <code>list</code> for the supported options.</p></div></div></div><div class="public anchor" id="var-delete.21"><h3>delete!</h3><div class="usage"><code>(delete! store id)</code></div><div class="doc"><div class="markdown"><p>Removes a block from the store. Returns true if the block was stored.</p></div></div></div><div class="public anchor" id="var-put.21"><h3>put!</h3><div class="usage"><code>(put! store block)</code></div><div class="doc"><div class="markdown"><p>Saves a block into the store. Returns the block record, updated with stat metadata.</p></div></div></div><div class="public anchor" id="var-stat"><h3>stat</h3><div class="usage"><code>(stat store id)</code></div><div class="doc"><div class="markdown"><p>Returns a map with an <code>:id</code> and <code>:size</code> but no content. The returned map may contain additional data like the date stored. Returns nil if the store does not contain the identified block.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L131">view source</a></div></div><div class="public anchor" id="var-default-algorithm"><h3>default-algorithm</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The hashing algorithm used if not specified in functions which create blocks.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L31">view source</a></div></div><div class="public anchor" id="var-from-file"><h3>from-file</h3><div class="usage"><code>(from-file file)</code><code>(from-file file algorithm)</code></div><div class="doc"><div class="markdown"><p>Creates a lazy block from a local file. The file is read once to calculate the identifier.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L39">view source</a></div></div><div class="public anchor" id="var-get"><h3>get</h3><div class="usage"><code>(get store id)</code></div><div class="doc"><div class="markdown"><p>Loads content for a multihash and returns a block record. Returns nil if no block is stored. The returned block is checked to make sure the id matches the requested hash.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L206">view source</a></div></div><div class="public anchor" id="var-list"><h3>list</h3><div class="usage"><code>(list store &amp; opts)</code></div><div class="doc"><div class="markdown"><p>Enumerates the stored blocks, returning a lazy sequence of block stats. Iterating over the list may result in additional operations to read from the backing data store.</p>
<ul>
  <li><code>:algorithm</code> only return blocks using this hash algorithm</li>
  <li><code>:after</code> list blocks whose id (in hex) lexically follows this string</li>
  <li><code>:limit</code> restrict the maximum number of results returned</li>
</ul></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L168">view source</a></div></div><div class="public anchor" id="var-load.21"><h3>load!</h3><div class="usage"><code>(load! block)</code></div><div class="doc"><div class="markdown"><p>Returns a literal block corresponding to the block given. If the block is lazy, the stream is read into memory and returned as a new literal block. If the block is already realized, it is returned unchanged.</p>
<p>The returned block will have the same extra attributes and metadata as the one given.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L82">view source</a></div></div><div class="public anchor" id="var-meta-stats"><h3>meta-stats</h3><div class="usage"><code>(meta-stats block)</code></div><div class="doc"><div class="markdown"><p>Returns stat information from a block&rsquo;s metadata, if present.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L244">view source</a></div></div><div class="public anchor" id="var-open"><h3>open</h3><div class="usage"><code>(open block)</code></div><div class="doc"><div class="markdown"><p>Opens an input stream to read the content of the block. Throws an IO exception on empty blocks.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L52">view source</a></div></div><div class="public anchor" id="var-read.21"><h3>read!</h3><div class="usage"><code>(read! source)</code><code>(read! source algorithm)</code></div><div class="doc"><div class="markdown"><p>Reads data into memory from the given source and hashes it to identify the block.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L66">view source</a></div></div><div class="public anchor" id="var-store.21"><h3>store!</h3><div class="usage"><code>(store! store source)</code><code>(store! store source algorithm)</code></div><div class="doc"><div class="markdown"><p>Stores content from a byte source in a block store and returns the block record.</p>
<p>If the source is a file, it will be streamed into the store. Otherwise, the content is read into memory, so this may not be suitable for large sources.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L221">view source</a></div></div><div class="public anchor" id="var-validate.21"><h3>validate!</h3><div class="usage"><code>(validate! block)</code></div><div class="doc"><div class="markdown"><p>Checks a block to verify that it confirms to the expected schema and has a valid identifier for its content. Returns nil if the block is valid, or throws an exception on any error.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L102">view source</a></div></div><div class="public anchor" id="var-with-stats"><h3>with-stats</h3><div class="usage"><code>(with-stats block stats)</code></div><div class="doc"><div class="markdown"><p>Adds stat information to a block&rsquo;s metadata.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L238">view source</a></div></div><div class="public anchor" id="var-write.21"><h3>write!</h3><div class="usage"><code>(write! block out)</code></div><div class="doc"><div class="markdown"><p>Writes block content to an output stream.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/core.clj#L75">view source</a></div></div></div></body></html>