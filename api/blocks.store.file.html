<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>blocks.store.file documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Blocks</span> <span class="project-version">0.5.0</span></span></a></h1></div><div class="sidebar primary"><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>blocks</span></div></div></li><li class="depth-2 branch"><a href="blocks.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="blocks.data.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></div></li><li class="depth-3 branch"><a href="blocks.store.cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cache</span></div></a></li><li class="depth-3 branch current"><a href="blocks.store.file.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>file</span></div></a></li><li class="depth-3 branch"><a href="blocks.store.memory.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>memory</span></div></a></li><li class="depth-3"><a href="blocks.store.tests.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tests</span></div></a></li><li class="depth-2"><a href="blocks.util.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="blocks.store.file.html#var-erase.21"><div class="inner"><span>erase!</span></div></a></li><li class="depth-1"><a href="blocks.store.file.html#var-file-store"><div class="inner"><span>file-store</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">blocks.store.file</h1><div class="doc"><div class="markdown"><p>Block storage backed by files in nested directories. Each block is stored in a separate file.</p>
<p>In many filesystems, directories are limited to 4,096 entries. In order to avoid this limit (and make navigating the blocks a bit more efficient), block content is stored in nested directories three levels deep. All path elements are lower-case hex-encoded bytes from the multihash.</p>
<p>The first level is the two-byte multihash prefix, which designates the algorithm and digest length. There will usually only be one or two of these directories. The second and third levels are formed by the first two bytes of the hash digest. Finally, the block is stored in a file containing the rest of the digest.</p>
<p>Thus, a block containing the content <code>foobar</code> would have the sha1 digest <code>97df3501149...</code> and be stored under the root directory at:</p>
<p><code>root/1114/97/df/35011497df3588b5a3...</code></p>
<p>Using this scheme, leaf directories should start approaching the limit once the user has 2^28 entries, or about 268 million blocks.</p></div></div><div class="public anchor" id="var-erase.21"><h3>erase!</h3><div class="usage"><code>(erase! store)</code></div><div class="doc"><div class="markdown"><p>Clears all contents of the file store by recursively deleting the root directory.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/store/file.clj#L197">view source</a></div></div><div class="public anchor" id="var-file-store"><h3>file-store</h3><div class="usage"><code>(file-store root)</code></div><div class="doc"><div class="markdown"><p>Creates a new local file-based block store.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/store/file.clj#L205">view source</a></div></div></div></body></html>